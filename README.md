# Inky 7.3" (Spectra6) 高機能スライドショー

Pimoroni製の6色e-Paperディスプレイ「Inky Impression 7.3"」に特化した、高機能なフォトフレーム・スライドショープログラムです。

単に画像を表示するだけでなく、長期間の無人運用を想定し、再起動からの自動再開や画像の増減への対応、詳細なログ出力など、堅牢性を高める機能を実装しています。

## 主な特徴 ✨

  * **e-Paperに最適化**: 6色のInky Impression 7.3"ディスプレイの特性に合わせた画像処理を行います。
  * **簡単な設定**: 表示する画像フォルダや更新間隔などを、わかりやすい `.env` ファイルで簡単に設定できます。
  * **撮影日時を自動表示**: JPEGのExif情報を読み取り、画像の撮影日と「〇年前」といった経過時間を自動でオーバーレイ表示します。
  * **状態の自動保存・復元**: 表示した画像の履歴を記憶しており、予期せぬ再起動後も、中断したところからスライドショーを再開します。
  * **画像の増減に自動対応**: 画像フォルダ内のファイル数が変わると自動で検知し、表示する画像のリストを更新します。
  * **豊富なログ出力**: 動作状況やエラーをログファイルに記録するため、問題が発生した際のトラブルシューティングが容易です。

-----

## 準備するもの

### ハードウェア

  * Raspberry Pi (任意のモデル)
  * Pimoroni Inky Impression 7.3" (Spectra6)
      * I2CとSPIが有効になっている必要があります。

### ソフトウェア (ライブラリ)

このスクリプトは以下のPythonライブラリに依存します。pipでインストールしてください。

```zsh
pip install pimoroni-inky pillow piexif python-dotenv
```

-----

## 使い方 🚀

### 1\. ファイルの配置

以下のようなディレクトリ構成でファイルを配置します。

```
my-slideshow/
├── slideshow.py      # このスクリプト
├── .env              # 設定ファイル (次項で作成)
└── (画像フォルダ)/        # 例: jpg/, photos/ など
    ├── photo1.jpg
    ├── photo2.jpeg
    └── photo3.png
```

### 2\. 設定ファイル `.env` の作成

スクリプトと同じ階層に `.env` という名前のファイルを作成し、以下の内容を参考に編集します。

```env
# ==================================
# Inky Slideshow 設定ファイル
# ==================================

# (必須) 表示する画像が入っているフォルダのパスを指定します。
# この例では、slideshow.py と同じ階層にある "jpg" フォルダを指します。
PHOTO_DIR="jpg/"

# (必須) 画像を切り替える間隔を秒単位で指定します。
# 例：30分 = 1800, 1時間 = 3600
INTERVAL_SECONDS=1800

# (任意) 日付表示に使用するフォントのフルパスを指定します。
# コメントを解除してパスを編集してください。
# 未設定の場合は、システムのデフォルトフォントが使用されます。
# FONT_PATH="/usr/share/fonts/truetype/noto/NotoSansCJK-Bold.ttc"
```

### 3\. スクリプトの実行

ターミナルから以下のコマンドでスクリプトを実行します。

```zsh
python3 slideshow.py
```

#### バックグラウンドで常時実行する場合

`nohup` を使うと、ターミナルを閉じてもスクリプトを実行し続けることができます。

```zsh
nohup python3 slideshow.py &
```

終了させる場合は `pkill -f slideshow.py` コマンドなどを使用してください。より本格的に運用する場合は `systemd` を使ってサービスとして登録することをお勧めします。

-----

## 高度な機能について

### 状態保存ファイル

  * スクリプトは、次に表示するべき画像のリストを `~/.cache/slideshow_state_spectra6.json` というファイルに保存します。
  * これにより、`reboot` コマンドや停電からの復帰後も、表示済みの画像が再度すぐに表示されることを防ぎます。
  * 画像フォルダ内のファイル数が変更された場合、このファイルは自動的にリセットされ、新しい画像リストが生成されます。

### ログファイル

  * スクリプトの動作記録は `~/.logs/slideshow_logs/slideshow_spectra6.log` に保存されます。
  * 「画像が見つからない」「ディスプレイが認識されない」といった問題が発生した場合は、このファイルの内容を確認してください。

-----

## 謝辞 (Acknowledgments)

このスクリプトは、以下の素晴らしいライブラリやツールのおかげで実現できました。開発者の皆様に心より感謝申し上げます。

  * **Pimoroni**: [Inky e-Paper Displsys](https://www.google.com/search?q=https://shop.pimoroni.com/collections/inky) のための優れたPythonライブラリ
  * **Pillow (PIL Fork)**: 強力な画像処理機能
  * **piexif**: 簡単なEXIF操作
  * **python-dotenv**: 環境変数の管理

また、このスクリプトのコード改良およびドキュメント作成の一部には、GoogleのAIアシスタント **Gemini** を活用しました。

-----

## ライセンス

このプロジェクトはMITライセンスです。ご自由にお使いください。
